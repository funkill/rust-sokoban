# Компоненты и сущности

В этой главе мы создадим наши компоненты и увидим, как создавать сущности и регистрировать чтобы сделать `specs` счастливым.

## Определение компонентов

Начнём с определения компонентов. Ранее мы обсуждали компоненты позиции, отображения и перемещения. На данном этапе мы опустим перемещение. Также нам необходимы некоторые компоненты для идентификации каждой сущности - например, нам нужен компонент стены и мы можем идентифицировать сущность как стену по наличию у неё такого компонента.

Надеюсь, что будет понятно, что компонент позиции будет хранить координаты `x`, `y` и `z`, которые говорят нам о положении чего-либо на карте. В компоненте отображения будем хранить строковый путь, указывающий на изображение, которое мы сможем отобразить. Все остальные компоненты - [маркерные](https://specs.amethyst.rs/docs/tutorials/11_advanced_component.html?highlight=marker#marker-components), не содержащие (пока что) данных.

```rust
{{#include ../../../code/rust-sokoban-c01-03/src/main.rs:13:42}}
```

Вместе со знакомым кодом на Rust мы тут видимо новый синтаксис. Здесь, в `#[storage(VecStorage)]`, мы используем могущественную особенность Rust, зовущуюся `процедурные макросы`. Макросы  этого типа по сути являются функциями, которые во время компиляции принимают какой-то один синтаксис и производят из него новый.

> ***ЕЩЁ:*** узнать больше о процедурных макросах вы можете [здесь](https://doc.rust-lang.org/book/ch19-06-macros.html).

## Регистрация компонентов

Чтобы сделать `specs` счастливым, мы должны заранее  сообщить ему какие компоненты мы будем использовать. Давайте создадим функцию, которая будет регистрировать компоненты в `specs`.

```rust
{{#include ../../../code/rust-sokoban-c01-03/src/main.rs:61:69}}
```

## Создание сущностей

Сущность - это просто числовой идентификатор, привязанный к набору компонентов. Таким образом, создание сущностей - это просто указание какие компоненты они содержат.

Теперь создание сущностей выглядит так:

```rust
{{#include ../../../code/rust-sokoban-c01-03/src/main.rs:71:124}}
```

## Ресурсы

Вы могли заметить, что мы ссылаемся на ресурсы, которые использовали выше при создании сущностей. Вы можете создать свои собственные ресурсы или загрузить те, которые использую я. Их вы можете увидеть дальше (просто сохраните их из контекстного меню).

![Floor tile](https://github.com/funkill/rust-sokoban/blob/master/books/ru/src/images/floor.png?raw=true) ![Wall tile](https://github.com/funkill/rust-sokoban/blob/master/books/ru/src/images/wall.png?raw=true) ![Player tile](https://github.com/funkill/rust-sokoban/blob/master/books/ru/src/images/player.png?raw=true) ![Box tile](https://github.com/funkill/rust-sokoban/blob/master/books/ru/src/images/box.png?raw=true) ![Box tile](https://github.com/funkill/rust-sokoban/blob/master/books/ru/src/images/box_spot.png?raw=true)

Давайте добавим изображения в наш проект. Мы создадим директорию `resources`, которая будет содержать все наши ресурсы. На данный момент, у нас будут только изображения, но в будущем у нас будут другие типы ресурсов, такие как конфигурационные файлы или аудио (об этом мы узнаем в [главе 3.3 - Звуки и события](/c03-03-sounds-events.html)). Мы также добавим директорию `images` и поместим туда наши изображения. Если вы хотите, то можете использовать другую структуру каталогов, но будьте внимательны далее в главе при использовании путей к изображениям.

```
├── resources
│   └── images
│       ├── box.png
│       ├── box_spot.png
│       ├── floor.png
│       ├── player.png
│       └── wall.png
├── src
│   └── main.rs
└── Cargo.toml
```

## Создание мира

Наконец, соберём всё вместе. Мы должны создать объект `specs::World`, мы добавим его в нашу структуру `Game` и мы первым делом инициализируем его в нашем `main`. Здесь полный код, который при запуске должен вывести пустое окно. Но мы сделали огромный прогресс в настройке наших игровых компонентов и сущностей! Далее мы перейдём к рендерингу, чтобы наконец увидеть что-то на экране!

```rust
{{#include ../../../code/rust-sokoban-c01-03/src/main.rs}}
```

Обратите внимание, что сейчас при запуске в консоли выводится сообщения о неиспользуемых импортах и/или полях. Не беспокойтесь об этом, мы исправим это в следующих главах.

> ***КОД:*** увидеть весь код из данной главы можно [здесь](https://github.com/iolivia/rust-sokoban/tree/master/code/rust-sokoban-c01-03).

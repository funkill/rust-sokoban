# Компоненты и сущности

В этой главе мы создадим наши компоненты и увидим, как создавать сущности и регистрировать всё правильно, чтобы `specs` был доволен.

## Определение компонентов

Начнём с определения компонентов. Ранее мы обсуждали компоненты позиции, отображения и перемещения. На данном этапе мы опустим перемещение. Также нам необходимы некоторые компоненты для идентификации каждой сущности — например, нам нужен компонент стены, чтобы мы могли идентифицировать сущность как стену по его наличию.

Достаточно очевидно, что компонент позиции будет хранить координаты x, y и z, которые скажут нам о положении чего-либо на карте. В компоненте отображения мы будем хранить строковый путь, указывающий на изображение, которое мы сможем отрисовать. Все остальные компоненты — [маркерные](https://specs.amethyst.rs/docs/tutorials/11_advanced_component.html?highlight=marker#marker-components), не содержащие (пока что) данных.

```rust
{{#include ../../../code/rust-sokoban-c01-03/src/main.rs:13:42}}
```

Вместе с уже знакомым кодом на Rust тут мы видим новый синтаксис. Здесь, в `#[storage(VecStorage)]`, мы используем могущественную особенность Rust — `процедурные макросы`. Макросы этого типа по сути являются функциями, которые во время компиляции принимают один синтаксис и производят из него другой.

> ***ЕЩЁ:*** Узнать больше о процедурных макросах вы можете [здесь](https://doc.rust-lang.org/book/ch19-06-macros.html).

## Регистрация компонентов

Чтобы `specs` не ругался, мы должны заранее сообщить ему, какие компоненты мы будем использовать. Давайте создадим функцию, которая будет регистрировать компоненты в `specs`.

```rust
{{#include ../../../code/rust-sokoban-c01-03/src/main.rs:61:69}}
```

## Создание сущностей

Сущность — это просто числовой идентификатор, привязанный к набору компонентов. Таким образом, создание сущностей — это просто указание, какие компоненты они содержат.

Теперь создание сущностей выглядит так:

```rust
{{#include ../../../code/rust-sokoban-c01-03/src/main.rs:71:124}}
```

## Ресурсы

Вы могли заметить, что при создании сущностей мы ссылаемся на ресурсы, которые будем использовать. Вы можете создать свои собственные ресурсы или загрузить те, которые использую я. Они находятся ниже (просто сохраните их как изображения из контекстного меню).

![Floor tile](https://github.com/funkill/rust-sokoban/blob/master/books/ru/src/images/floor.png?raw=true) ![Wall tile](https://github.com/funkill/rust-sokoban/blob/master/books/ru/src/images/wall.png?raw=true) ![Player tile](https://github.com/funkill/rust-sokoban/blob/master/books/ru/src/images/player.png?raw=true) ![Box tile](https://github.com/funkill/rust-sokoban/blob/master/books/ru/src/images/box.png?raw=true) ![Box tile](https://github.com/funkill/rust-sokoban/blob/master/books/ru/src/images/box_spot.png?raw=true)

Давайте добавим изображения в наш проект. Мы создадим директорию `resources`, которая будет содержать все наши ресурсы. На данный момент у нас будут только изображения, но в будущем появятся другие типы ресурсов, такие как конфигурационные файлы или аудио (об этом мы узнаем в [главе 3.3 — Звуки и события](/c03-03-sounds-events.html)). Мы также добавим директорию `images` и поместим туда наши изображения. Если хотите — можете использовать другую структуру каталогов, но будьте внимательны в дальнейшем везде, где мы используем пути к изображениям.

```
├── resources
│   └── images
│       ├── box.png
│       ├── box_spot.png
│       ├── floor.png
│       ├── player.png
│       └── wall.png
├── src
│   └── main.rs
└── Cargo.toml
```

## Создание мира

Наконец, соберём всё вместе. Мы должны создать объект `specs::World`, чтобы добавить его в структуру `Game`. Он будет первым, что мы инициализируем в нашем `main`. Ниже находится полный код, который при запуске выведет то же самое пустое окно — но мы сделали огромный прогресс в настройке игровых компонентов и сущностей! Далее мы перейдём к отрисовке, чтобы наконец увидеть что-то на экране!

```rust
{{#include ../../../code/rust-sokoban-c01-03/src/main.rs}}
```

Обратите внимание, что сейчас при запуске в консоли выводится сообщение о неиспользуемых импортах и/или полях. Не беспокойтесь, мы исправим это в следующих главах.

> ***КОД:*** Увидеть весь код из данной главы можно [здесь](https://github.com/iolivia/rust-sokoban/tree/master/code/rust-sokoban-c01-03).

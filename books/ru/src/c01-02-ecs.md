# Entity Component System

В этой главе мы более детально обсудим Sokoban и то, как мы спроектируем нашу игру.

## Sokoban

Если вы раньше не встречались с Sokoban на GameBoy, то здесь вы можете увидеть, как выглядит игра. У нас есть стены и коробки, а цель игры в том, чтобы игрок передвинул все коробки на их места путём толкания их.

![Sokoban play](./images/sokoban.gif)

## ECS

ECS (Entity Component System) - это архитектурный шаблон написания игр, который следует принципу композиции, а наследования. Мы будем активно использовать ECS в этом проекте, как и в большинстве игр на Rust, так что давайте потратим немного времени на ознакомление с его ключевыми концепциями:

- **Components** (компоненты) - структуры, содержащие только данные. Они содержат разные характеристики сущностей, например: позиция, отображаемость, передвигаемость и другие. Здесь ключевой частью являются чистые данные, без поведения.
- **Entities** (сущности) - могу содержать множество компонентов, например, игрок может характеризоваться позицией, отображаемостью и передвигаемость, в то время как пол может иметь только позицию и отображаемость, а передвигаться не может. Сущности - это просто контейнеры с одним или несколькими компонентами и уникальным идентификатором.
- **Systems** (системы) - используют сущности и компоненты и содержат поведение и логику, основанную на имеющихся данных. Например, вы можете иметь систему рендеринга, которая только проходится по всем сущностям, имеющим компонент отображения, который рисует их. Ключевым здесь является то, что компоненты сами по себе не имеют никакого поведения, а используют системы для интерпретирования и работы с данными.

Если это для вас всё ещё является бессмыслицей, не волнуйтесь, в следующей главе мы обсудим несколько практических примеров, применимых к нашей игре.

## Архитектура Sokoban

Основываясь на описанном выше, мы теперь знаем как наша игра должна работать. Нам нужны несколько различных типов "вещей": стены, игрок, этажи, коробки и места для них. Это будут наши *сущности*.

Теперь мы должны определить из чего будут сделаны наши сущности, т.е. какие *компоненты* нам нужны. Итак, прежде всего нам нужно знать где что находится на карте, для чего нам нужен какой-либо позиционный компонент. Затем, некоторые (но не все) сущности могут перемещаться. Игрок может двигаться, но коробки тоже могут перемещаться, если их толкает игрок. И наконец, нам нужен способ отрисовки каждой сущности, так что нам нужен рисующий компонент.

Вот как выглядит наша идея о сущностях и компонентах:

1. **Игрок**: позиционируемый, отображаемый, передвигаемый
2. **Стена**: позиционируемая, отображаемая
3. **Этаж**: позиционируемый, отображаемый
4. **Коробка**: позиционируемая, отображаемая, передвигаемая
5. **Место коробки**: позиционируемое, отображаемое

На первый взгляд ECS может показаться сложной, но не огорчайтесь, если вы до сих пор ничего не поняли или это не имеет ничего похожего на то, что вы видели в других языках.

## Specs

Наконец, добавим пакет ECS. Их достаточно много, но в этой книге мы будем использовать [specs](https://specs.amethyst.rs/docs/tutorials/).

```
{{#include ../../../code/rust-sokoban-c01-03/Cargo.toml:9:11}}
```

Теперь начнём создавать сущности и компоненты!

> ***КОД:*** Увидеть весь код из данной главы можно [здесь](https://github.com/iolivia/rust-sokoban/tree/master/code/rust-sokoban-c01-03).
